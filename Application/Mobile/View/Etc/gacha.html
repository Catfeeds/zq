<include file="Etc/head"/>
<link rel="stylesheet" href="__CSS__/etc/ex_activity.css">
<body class="bd_lucky">
    
	<!-- 二级头部 s -->
<!-- 	<header id="other_header">
    	<a href="javascript:;"></a>抽奖中心
    </header> -->
    <!-- 二级头部 e -->
	<div class="Imgpng">
        <img class="bg" src="__IMAGES__/etc/bg_cj_top3.png" />
    </div>
	<!--抽奖信息 begin-->
    <div class="cj-info">
        <div class="record">
            <div class="record-list">
                <ul>
                <volist name="gachaLog" id="item">
                    <li>
 						恭喜{$item.username|substr=###,0,2}{:rand(1,9)}****{:rand(1,9)}{:rand(1,9)}{:rand(1,9)}{:rand(1,9)}获得
                        <switch name="item.prize_id">
                            <case value="1">iphone6S(128G)</case>
                            <case value="2">恒大7月VIP门票</case>
                            <case value="3">4G流量卡</case>
                            <case value="4">行车记录仪</case>
                            <case value="5">2000积分</case>
                            <case value="6">4G流量卡</case>
                            <case value="7">1000积分</case>
                            <case value="8">欧洲杯官方T恤</case>
                        </switch>
                    </li>
                </volist>
                </ul>
            </div>
        </div>
    </div>
    <!--抽奖信息 end-->
    <div class="Imgpng">
        <img class="bg" src="__IMAGES__/etc/monkey.png" alt="" />
    </div>
    <!--抽奖转盘 begin-->
    <div class="cj-box">
        <img class="bg" src="__IMAGES__/etc/bg_cj_zhuanpan.gif" alt="" />
        <ul id="cj-a" class="cj eight-item clearfix">
        <volist name="prize_arr" id="item">
            <li><div><p><img src="{$item.img}" alt="{$item.prize}" /></p><p>{$item.prize}</p></div></li>
        </volist>
            <div class="bt"></div>
        </ul>
    </div>
	<!-- 奖品弹窗 -->
    <div class="dialog">
        <div class='text t0 jieguo'>
            <p>获得了<span class="cpName"></span></p>
            <p> <img/> </p>
            <p><span class="tishi"></span> </p>
            <p class="ajax_btn"></p>
            <div class="close_btn"></div>
        </div>
    </div> 
    <!--抽奖信息 begin-->
    <div class="cj-cs">
        <p>
        <span class="only">您还有：<em id="gacha_times">{$gacha_times|default=0}</em>次抽奖机会</span>
        </p>
        <p><a href="javascript:;" onclick="showdiv();">兑换码兑换抽奖机会 >></a></p>
    </div>
    <!--抽奖信息 end-->
    <!--抽奖转盘 end-->
    
    <!--抽奖信息 begin-->
    <!-- <div class="cj-cs">
        <p><span style="color:#d83313;">温馨提示：</span>积分可兑换金币，进行现金提现</p>
    </div> -->
    <!--抽奖信息 end-->
    <div class="cai_con" style="color: #fff">
        <p><strong>活动规则</strong></p>
        <p>1、本次抽奖活动对象为ETC车宝用户，抽奖前须先注册成为全球体育用户；</p>
        <p>2、用户只能通过ETC车宝的推荐币来获取抽奖机会，1000推荐币=1次抽奖机会；</p>
        <p>3、虚拟奖品将实时发放，实物奖品将在活动结束之后3天内发放；抽中话费的用户一定要填手机号，否则将失去奖品；</p>
        <p>4、积分用途：积分可兑换金币，金币可提现（1金币=1元RMB）；</p>
        <p>6、本次活动最终解释权归全球体育所有。</p>
        <!-- <div class="title">
        </div>
        <div class="cai_list_con">
          <ul class="clearfix">
                <li class="fl prize_list">
                    <p class="title_p"><em class="red">50元</em>加油卡</p>
                    <figure><img src="__IMAGES__/etc/50-cad.png"></figure>
                    <a href="javascript:;" onclick="">500推荐币</a>
                </li>
                <li class="fr prize_list">
                    <p class="title_p"><em class="red">100元</em>加油卡</p>
                    <figure><img src="__IMAGES__/etc/100-cad.png"></figure>
                    <a href="javascript:;" onclick="">1000推荐币</a>
                </li>
            </ul>
        </div> -->
    </div>
    <!-- 模态窗口开始 -->
    <div id="flow" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" onclick="$('#flow,#bg').hide()"><span></span></button>
                <h4 class="modal-title">领奖提示</h4>
            </div>
            <div class="modal-body fs22" style="padding: .2rem;">
                <ul class="modal_ul q-tc">
                    <li>温馨提示<br>请输入领取流量手机号,流量在24小时内到账</li>
                </ul>
                <p id='info_title' class="red q-tc" style="margin-bottom: .1rem;">请正确填写以下信息</p>

                <div class="form_div clearfix">
                    <div class="fl input-name">手机号：</div>
                    <div class="fr input-con">
                        <input id="re_phone" class="form-control required mobile" type="text">
                    </div>
                </div>
                <div class="modal-btn" style="margin-top: .2rem;">
                    <button type="button" id='flow-submit' class="btn btn-orange submit fs24">提交</button>
                    <button type="button" onclick="$('#flow,#bg').hide()" class="btn btn-default fs24" data-dismiss="modal">放弃领取</button>
                </div>
            </div>
        </div>
    </div>
    <!-- <div id="flow" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" onclick="$('#flow').hide()"><span></span></button>
                <h4 class="modal-title">领奖提示</h4>
            </div>
            <div class="modal-body fs22" style="padding: .2rem;">
                <ul class="modal_ul q-tc">
                    <li>注册成功！<br>您已获得欧洲杯球衣一件！</li>
                </ul>
                <p id='info_title' class="red q-tc" style="margin-bottom: .1rem;">请正确填写以下信息</p>
                <div class="form_div clearfix">
                    <div class="fl input-name">姓名：</div>
                    <div class="fr input-con">
                        <input id="re_name" class="form-control required name" name="name" type="text">
                    </div>
                </div>
                <div class="form_div clearfix">
                    <div class="fl input-name">手机号：</div>
                    <div class="fr input-con">
                        <input id="re_phone" class="form-control required mobile" name="mobile" type="text">
                    </div>
                </div>
                <div class="form_div clearfix">
                    <div class="fl input-name">地址：</div>
                    <div class="fr input-con">
                        <input id="re_address" class="form-control required mobile" name="mobile" type="text">
                    </div>
                </div>
                <div class="modal-btn">
                    <button type="button" id='js-change' class="btn btn-orange submit fs24">确定</button>
                    <button type="button" onclick="$('#flow').hide()" class="btn btn-default fs24" data-dismiss="modal">取消</button>
                </div>
            </div>
        </div>
    </div> -->
    <div id="show" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" onclick="hidediv();"><span></span></button>
                <h4 class="modal-title">兑换码兑换抽奖机会</h4>
            </div>
            <div class="modal-body fs22" style="padding: .2rem;">
            	<div class="form_div clearfix" style="margin: .6rem 0">
                    <div class="fl input-name">兑换码：</div>
                    <div class="fr input-con">
                        <input id="code" type="text" />
                    </div>
                </div>
                <input type="hidden" id="userid" value="{$userInfo.userid}"/>
                <div class="modal-btn">
                    <button type="button" class="btn btn-orange submit fs24 doGacha">确定</button>
                    <button type="button" onclick='hidediv()' class="btn btn-default fs24" data-dismiss="modal">取消</button>
                </div>
            </div>
        </div>
    </div>
    <input type="hidden" id="gacha_id" value=""/>
    <div id="bg" class="modal-backdrop" style="z-index: 1040;"></div>
    <!-- 模态窗口结束 -->
</body>
<!-- 本页所需的js -->
<script type="text/javascript" src="__JS__/etc/jq.orbit.js"></script>
<script type="text/javascript" src="__JS__/etc/script.js"></script>
<script type="text/javascript" src="__JS__/etc/touch-0.2.14.min.js"></script>
<script>
    $('#flow-submit').on('click',function(){
        var mobile = $("#re_phone").val();
        if(mobile == ''){
            showMsg('请输入手机号','error');
            return;
        }
        if (!/^1[3456789]{1}\d{9}$/.test(mobile)){
            showMsg('手机号码格式不正确','error');
            return;
        }
        var gacha_id = $("#gacha_id").val();
        if(gacha_id == ''){
            showMsg('非法操作','error');
            return;
        }
        var userid = $("#userid").val();
        if(userid == ''){
            showMsg('请先登录','error');
            return;
        }
        $(this).attr('disabled','disabled');
        $.ajax({
            type:'post',
            data:{mobile:mobile,gacha_id:gacha_id,userid:userid},
            url:'/Etc/sendingFlow.html',
            success:function(data){
                if(data.status == 1){
                    $('#flow,#bg').hide()
                    showMsg(data.info);
                }else{
                    showMsg(data.info,'error');
                }
                $("#re_phone").val('');
                $('#flow-submit').removeAttr('disabled');
            }
        })
    })
    $(".doGacha").on('click',function(){
        var userid = $("#userid").val();
        if(userid == ''){
            showMsg('请先登录','error');
            return;
        }
        var code = $("#code").val();
        if(code == ''){
            showMsg('请输入兑换码','error');
            return;
        }
        $(this).attr('disabled','disabled');
        $.ajax({
            type:'post',
            data:{code:code,userid:userid},
            url:'/Etc/doGacha.html',
            success:function(data){
                if(data.status == 1){
                    $("#code").val('');
                    $("#gacha_times").text(data.info);
                    hidediv();
                    showMsg("兑换成功");
                }else{
                    showMsg(data.info,'error');
                }
                $('.doGacha').removeAttr('disabled');
            }
        })
    })
	$(function () {
		touch.on(".bd-lucky .popup2 ul li", "touchstart", function (ev) {
			ev.preventDefault();
		});
		touch.on(".bd-lucky .popup2 ul li", "swiperight", function (ev) {
			$('.bd-lucky .popup2 .btn-pre').click();
			console.log("向右滑动");
		});
		touch.on(".bd-lucky .popup2 ul li", "swipeleft", function (ev) {
			$('.bd-lucky .popup2 .btn-next').click();
			console.log("向左滑动");
		});

		var $this = $(".record-list"); 
		var timeout = setTimeout(setElSize, 500);
		function setElSize() {
			$(".bd-lucky .popup2 ul").height($(".bd-lucky .popup2 ul li").height()); //设置弹窗礼物的高度v
			var recordLi = $this.find("li");
			$this.height((recordLi.height() + parseInt(recordLi.css("padding-top")) * 2) * 4);
		}

		//抽奖
		$(document).on("click", ".btn-run", function () {
			var num = Math.floor(Math.random() * 10 + 1);
			num = 6;
			var cjCopy = $(".cj").clone();
			$(".cj").remove();
			cjCopy.insertAfter(".cj-box .bg");
			$(".cj").luckDraw({
				line: 3, //几行
				list: 4, //几列
				click: ".bt", //点击对象
				stime: num
			})
			$(".bt").click();
		});

		//领取记录滚动
		var scrollTimer;
		$this.hover(function () {
			clearInterval(scrollTimer);
		}, function () {
			scrollTimer = setInterval(function () {
				scrollNews($this);
			}, 2000);
		}).trigger("mouseout");

		//弹出层
		showdiv();
		hidediv();
	});
	//弹出层
	function showdiv() { 
		document.getElementById("bg").style.display ="block";
		document.getElementById("show").style.display ="block";
	}
	function hidediv() {
		document.getElementById("bg").style.display ='none';
		document.getElementById("show").style.display ='none';
	}
	//领取记录滚动
	function scrollNews(obj) {
		var $self = obj.find("ul:first");
		var lineHeight = $self.find("li:first").height() + parseInt($self.find("li:first").css("padding"))*2;
		$self.animate({ "margin-top": -lineHeight + "px" }, 800, function () {
			$self.css({ "margin-top": "0px" }).find("li:first").appendTo($self);
		})
	}

</script>
</html>