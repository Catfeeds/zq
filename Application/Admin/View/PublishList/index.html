<include file="Public:pagerForm" />

<div class="pageHeader">
	<form rel="pagerForm" onsubmit="return navTabSearch(this);" action="__URL__" method="post">
	<input type="hidden" name="class_id" value="{$_REQUEST.class_id}">
	<input type="hidden" name="game_id" value="{$_REQUEST.game_id}">
	<input type="hidden" name="is_home" value="{$_REQUEST.is_home}">
	<input type="hidden" name="user_id" value="{$_REQUEST.user_id}">
	<div class="searchBar">
		<ul class="searchContent">
			<li>
				<label>ID：</label>
				<input type="text" name="id" value="{$_REQUEST.id}" size="10" />
			</li>
			<li>
				<label>资讯标题：</label>
				<input type="text" name="title" value="{$_REQUEST.title}"/>
			</li>
			<li>
				<label>专家作者：</label>
				<input type="text" name="user_name" value="{$_REQUEST.user_name}"/>
			</li>
			<li>
				<label>关键词模糊搜索：</label>
				<input type="text" name="label" value="{$_REQUEST.label}"/>
			</li>
			<li>
				<label>所属分类：</label>
				<select name="class_id" class="combox" onchange="$(form).submit()">
					<option value="" selected>全部</option>
					<volist name="PublishClass" id="item">
						<option value="{$item.id}" <eq name="item.id" value="$_REQUEST.class_id">selected</eq> >{$item.name}</option>
						<notempty name="item.childs">
							<volist name="item.childs" id="item2">
								<option value="{$item2.id}" <eq name="item2.id" value="$_REQUEST.class_id">selected</eq> >|_{$item2.name}</option>
								<notempty name="item2.childs">
									<volist name="item2.childs" id="item3">
										<option value="{$item3.id}" <eq name="item3.id" value="$_REQUEST.class_id">selected</eq> >|__{$item3.name}</option>
									</volist>
								</notempty>
							</volist>
						</notempty>
					</volist>
				</select>
			</li>
			<li>
				<label>审核编辑：</label>
				<select name="author" class="combox" onchange="$(form).submit()">
					<option value="" selected>全部</option>
					<volist name="editor" id="item">
						<option value="{$item.id}" <eq name="item.id" value="$_REQUEST.author">selected</eq>
						>{$item.nickname}</option>
					</volist>
				</select>
			</li>
			<if condition="$_REQUEST.class_id eq '10'">
                <li>
                    <label >手机号：</label>
                    <input type="text" name="username" value="{$_REQUEST.username}"/>
                </li>
                <li>
                    <label >昵称：</label>
                    <input type="text" name="nick_name" value="{$_REQUEST.nick_name}"/>
                </li>
            </if>
            <li>
            	<label>原创：</label>
            	<select name="is_original" class="combox" onchange="$(form).submit()">
            		<option value="" selected>全部</option>
            		<option value="1" <if condition="$_REQUEST.is_original eq '1'">selected</if> >是</option>
            		<option value="0" <if condition="$_REQUEST.is_original eq '0'">selected</if> >否</option>
            	</select>
            </li>
			<li>
				<label>状态：</label>
				<select name="status" class="combox" onchange="$(form).submit()">
					<option value="" selected>全部</option>
					<option value="1" <if condition="$_REQUEST.status eq '1'">selected</if> >正常</option>
					<option value="0" <if condition="$_REQUEST.status eq '0'">selected</if> >待发布</option>
					<option value="2" <if condition="$_REQUEST.status eq '2'">selected</if> >待审核</option>
				</select>
			</li>
			<li>
				<label>APP首页推荐：</label>
				<select name="is_recommend" class="combox" onchange="$(form).submit()">
					<option value="" selected>全部</option>
					<option value="0" <if condition="$_REQUEST.is_recommend eq '0'">selected</if> >否</option>
					<option value="1" <if condition="$_REQUEST.is_recommend eq '1'">selected</if> >推荐</option>
					<option value="2" <if condition="$_REQUEST.is_recommend eq '2'">selected</if> >重点推荐</option>
				</select>
			</li>
			<li>
				<label>WEB首页推荐：</label>
				<select name="web_recommend" class="combox" onchange="$(form).submit()">
					<option value="" selected>全部</option>
					<option value="0" <if condition="$_REQUEST.web_recommend eq '0'">selected</if> >否</option>
					<option value="1" <if condition="$_REQUEST.web_recommend eq '1'">selected</if> >推荐</option>
					<option value="2" <if condition="$_REQUEST.web_recommend eq '2'">selected</if> >重点推荐</option>
				</select>
			</li>
			<li>
				<label>栏目推荐：</label>
				<select name="is_channel_push" class="combox" onchange="$(form).submit()">
					<option value="" selected>全部</option>
					<option value="0" <if condition="$_REQUEST.is_channel_push eq '0'">selected</if> >否</option>
					<option value="1" <if condition="$_REQUEST.is_channel_push eq '1'">selected</if> >是</option>
				</select>
			</li>
			<li>
				<label>头条推荐：</label>
				<select name="top_recommend" class="combox" onchange="$(form).submit()">
					<option value="" selected>全部</option>
					<option value="0" <if condition="$_REQUEST.top_recommend eq '0'">selected</if> >否</option>
					<option value="1" <if condition="$_REQUEST.top_recommend eq '1'">selected</if> >是</option>
				</select>
			</li>
			<!--<li>-->
				<!--<label>花生地铁WIFI推荐：</label>-->
				<!--<select name="hs_recommend" class="combox" onchange="$(form).submit()">-->
					<!--<option value="" selected>全部</option>-->
					<!--<option value="0" <if condition="$_REQUEST.hs_recommend eq '0'">selected</if> >否</option>-->
					<!--<option value="1" <if condition="$_REQUEST.hs_recommend eq '1'">selected</if> >是</option>-->
				<!--</select>-->
			<!--</li>-->
			<li>
				<label>APP置顶：</label>
				<select name="app_recommend" class="combox" onchange="$(form).submit()">
					<option value="" selected>全部</option>
					<option value="0" <if condition="$_REQUEST.app_recommend eq '0'">selected</if> >否</option>
					<option value="1" <if condition="$_REQUEST.app_recommend eq '1'">selected</if> >是</option>
				</select>
			</li>
			<li>
				<label>世界杯话题推荐：</label>
				<select name="worldcup_recommend" class="combox" onchange="$(form).submit()">
					<option value="" selected>全部</option>
					<option value="0" <if condition="$_REQUEST.worldcup_recommend eq '0'">selected</if> >否</option>
					<option value="1" <if condition="$_REQUEST.worldcup_recommend eq '1'">selected</if> >是</option>
				</select>
			</li>
			<li>
				<label>日期：</label>
				<input type="text" readonly="true" datefmt="yyyy-MM-dd" class="date textInput readonly valid" value="{$_REQUEST.startTime}" name="startTime" size="10">至
				<input type="text" readonly="true" datefmt="yyyy-MM-dd" class="date textInput readonly valid" value="{$_REQUEST.endTime}" name="endTime" size="10">
			</li>
		</ul>
		<div class="subBar">
			<ul>
				<li>
                    <div class="buttonActive"><div class="buttonContent"><button type="submit">查询</button></div></div>
                </li>
                 <li>
                    <a class="button" title="查询框" mask="true" target="dialog" href="__URL__/pageSearch.html?SignPublishListIndex=1&actionName=__ACTION__&{:http_build_query($_REQUEST)}" height="350"><span>高级检索</span></a>
                </li>
			</ul>
		</div>
	</div>
	</form>
</div>

<div class="pageContent">
	<div class="panelBar">
		<ul class="toolBar">
			<if condition="$_REQUEST.class_id neq '10'">
			<li><a class="add" href="__URL__/add/class_id/{$_REQUEST.class_id}" target="navTab" mask="true" rel="add_publish"><span>新增</span></a></li>
			</if>
			<li><a class="delete" href="__URL__/delete/id/{sid_record}" target="ajaxTodo" title="你确定要删除吗？" warn="请选择文章"><span>删除</span></a></li>
			<li>
			<a class="delete" href="__URL__/delAll" posttype="string" rel="id" target="selectedTodo" warn="请选择记录" title="确实要删除这些记录吗?">
			<span>批量删除</span>
			</a>
			</li>
			<if condition="$_REQUEST.class_id eq '10'">
				<li class="line"></li>
				<li><a class="icon" href="__URL__/runQuiz" target="dialog" mask="true"><span>推介结果结算</span></a></li>
			</if>
			<if condition="$_REQUEST.class_id neq '10'">
			<li><a class="edit" href="__URL__/edit/id/{sid_record}/class_id/{$_REQUEST.class_id}" target="navTab" mask="true" warn="请选择用户"><span>编辑</span></a></li>
			</if>
			<if condition="$_REQUEST.class_id eq ''">
			<li><a class="delete" href="__URL__/delWeek" target="ajaxTodo" title="你确定要删除吗？" mask="true" ><span>删除7天前未编辑资讯</span></a></li>
			</if>
			<if condition="$_REQUEST.is_home neq ''"><li><a class="checkOn" style="position: relative;"><img style="position: absolute;left: 0;top: 2px;" src="/Public/Images/<if condition='$isCheckOn eq 1'>ok<else/>error</if>.gif" width="20" height="20" border="0"><span>审核<if condition='$isCheckOn eq 1'>开启<else/>关闭</if></span></a></li></if>
		</ul>
	</div>

	<table class="table" width="100%" layoutH="138">
		<thead>
		<tr>
			<th width="2%" style="cursor: default;">
				<div class="gridCol" title="">
					<input class="checkboxCtrl" type="checkbox" group="id">
				</div>
			</th>
			<th width="2%"  orderField="id" <if condition="$_REQUEST._order eq 'id'">class="{$_REQUEST._sort}"<else /> class="desc"</if>>ID</th>
			<th width="2%">封面图</th>
			<th width="10%">标题</th>
			<th width="3%">分类</th>
			<th width="3%">来源</th>
			<th width="4%">审核编辑</th>
			<th width="3%">专家作者</th>
			<th width="3%">APP首页推荐</th>
			<th width="3%">WEB首页推荐</th>
			<th width="3%">栏目推荐</th>
			<th width="3%">头条推荐</th>
			<th width="3%">APP置顶</th>
			<th width="3%" orderField="click_number" <if condition="$_REQUEST._order eq 'click_number'">class="{$_REQUEST._sort}"<else /> class="desc"</if>>点击量</th>
            <th width="3%">评论人数</th>
			<th width="3%">评论数</th>
			<th width="2%">原创</th>
			<th width="2%" orderField="status" <if condition="$_REQUEST._order eq 'status'">class="{$_REQUEST._sort}" <else /> class="desc"</if>>状态</th>
			<th width="5%" orderField="add_time" <if condition="$_REQUEST._order eq 'add_time'">class="{$_REQUEST._sort}" <else /> class="desc"</if>>网站发布时间</th>
			<th width="5%" orderField="app_time" <if condition="$_REQUEST._order eq 'app_time'">class="{$_REQUEST._sort}" <else /> class="desc"</if>>APP发布时间</th>
			<th width="5%" orderField="update_time" <if condition="$_REQUEST._order eq 'update_time'">class="{$_REQUEST._sort}" <else /> class="desc"</if>>最后编辑</th>
			<if condition="$_REQUEST.class_id eq '10'">
            	<th width="2%">结果</th>
            </if>
			<if condition="$_REQUEST.type eq '1'">
				<th width="3%">审核状态</th>
			</if>
			<th width="5%">操作</th>
		</tr>
		</thead>
		<tbody>
		<notempty name="list">
			<volist id="vo" name="list">
				<tr target="sid_record" rel="{$vo['id']}">
					<td style="width: 10px;">
						<div>
							<input type="checkbox" value="{$vo.id}" name="id">
						</div>
					</td>
					<td>{$vo['id']}</td>
					<td><empty name="vo.img">无<else/><a href="{$vo.img}" target="_blank" title="查看封面图片"><img src="{$vo['img']}" alt="封面图片" width="30" height="30" /></a></empty></td>
					<td title="{$vo['title']}">
						<a target="_blank" href="{$vo.href}">{$vo['title']}</a>
					</td>
					<td><if condition="$showShort eq 1">{$vo['remarks']}<else/>{$vo['name']}</if></td>
					<td><a target="_blank" href="{$vo.capture_url}">{$vo['source']}</a></td>
					<td>{$vo['authorName']}<if condition="$vo.editor neq ''">（{$vo['editorName']}）</if></td>
					<td><if condition="$vo.nick_name neq ''"><a href="__ADMIN__/FrontUser/index/id/{$vo['user_id']}" target="navTab">{$vo.nick_name}</a></if></td>
					<td>
					    <switch name="vo.is_recommend">
					        <case value="1">推荐</case>
					        <case value="2">重点推荐</case>
					        <default />否
					    </switch>
					</td>
					<td>
						<switch name="vo.web_recommend">
							<case value="1">推荐</case>
							<case value="2">重点推荐</case>
							<default />否
						</switch>
					</td>
					<td>
					    <switch name="vo.is_channel_push">
					        <case value="0">否</case>
					        <case value="1">是</case>
					    </switch>
					</td>
					<td>
						<switch name="vo.top_recommend">
							<case value="0">否</case>
							<case value="1">是</case>
						</switch>
					</td>
					<td>
						<switch name="vo.app_recommend">
							<case value="0">否</case>
							<case value="1">是</case>
						</switch>
					</td>
					<td>{$vo['click_number']}</td>
                    <td>{$vo['discussantNum']|default = 0}</td>
					<td>{$vo.commentNum|default =0}</td>
					<td>
						<switch name="vo.is_original">
						    <case value="0">否</case>
						    <case value="1">是</case>
						</switch>
					</td>
					<td>{$vo['status']|getStatus}</td>
					<td><notempty name="vo.add_time">{$vo['add_time']|date="Y-m-d H:i",###}<else/>未设置</notempty></td>
					<td><notempty name="vo.app_time">{$vo['app_time']|date="Y-m-d H:i",###}<else/>未设置</notempty></td>
					<td><notempty name="vo.update_time">{$vo['update_time']|date="Y-m-d H:i",###}<else/>未编辑</notempty></td>
					<if condition="$_REQUEST.class_id eq '10'">
	                    <td>
	                        <switch name="vo.result">
		                        <case value="1"><div style="color:red;">赢</div></case>
		                        <case value="0.5"><div style="color:red;">赢半</div></case>
		                        <case value="2"><div style="color:green;">平</div></case>
		                        <case value="-1"><div style="color:blue;">输</div></case>
		                        <case value="-0.5"><div style="color:blue;">输半</div></case>
		                        <case value="-10"><div style="color:black;">取消</div></case>
		                        <case value="-11|-2"><div style="color:black;">待定</div></case>
		                        <case value="-12"><div style="color:black;">腰斩</div></case>
		                        <case value="-13"><div style="color:black;">中断</div></case>
		                        <case value="-14"><div style="color:black;">推迟</div></case>
		                        <default/>--
	                    </switch>
	                    </td>
                    </if>
					<if condition="$_REQUEST.type eq '1'">
						<td>
							<switch name="vo.status">
								<case value="0"><div style="color:red;">未通过/禁用</div></case>
								<case value="1"><div style="color:green;">已通过</div></case>
								<case value="2"><div style="color:#161f32;">待审核</div></case>
							</switch>
						</td>
					</if>
					<td>
                        <a href="__URL__/edit/id/{$vo.id}/class_id/{$_REQUEST.class_id}" target="navTab" mask="true" title="{$vo.name}编辑" rel="editPage">编辑</a>
						|

						<switch name="vo.status">
							<case value="0"><a href="__URL__/resume/id/{$vo.id}/navTabId/" target="ajaxTodo" callback="navTabAjaxDone">恢复</a></case>
							<case value="1"><a href="__URL__/forbids/id/{$vo.id}" target="ajaxTodo" callback="navTabAjaxDone">禁用</a></case>
							<case value="2"><a href="__URL__/checkPass/id/{$vo.id}/navTabId/" target="ajaxTodo" callback="navTabAjaxDone">批准</a></case>
						</switch>

						|

						<a href="__URL__/addComment/id/{$vo.id}" target="dialog" mask="true" height="700" width="700">评论</a>
					</td>
				</tr>

			</volist>
		</notempty>
		</tbody>
	</table>

    <include file="Public:pagerNum" />


</div>
<script>
    function editResult(obj) {

        var publish_id = $(obj).attr('publish_id');
        var result = $(obj).val();
        $.ajax({
            type : 'POST',
            url  : '__URL__/editResult.html',
            data : {'id':publish_id,'result':result},
            dataType : 'json',
            success: function(data){
                if(data.status){
                    alert("推介结果修改成功！");
                }else{
                    alert("推介结果修改失败！");
                }
            }

        });
    }
	var ok = "__PUBLIC__/Images/ok.gif";
	var error = "__PUBLIC__/Images/error.gif";
	var checkType = "{$checkType}";
	$('.checkOn').on('click',function(){
		$.ajax({
			url: "__URL__/checkOn.html",
			type:'post',
			data:{type:checkType},
			dataType: "json",
			success: function(data){
				if(data == 1)
				{
					$('.checkOn').find('img').prop('src',ok);
					$('.checkOn').find('span').html('审核开启');
				}else{
					$('.checkOn').find('img').prop('src',error);
					$('.checkOn').find('span').html('审核关闭')
				}
			}
		});
	})
</script>


